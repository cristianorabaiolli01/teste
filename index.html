<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÆSIR • interface cinza</title>
    <style>
        /* ===== RESET — domínio do cinza, toques de preto ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* paleta: cinza é a luz, preto é a sombra */
        :root {
            --iron-95: #0F0F0F;        /* preto absoluto apenas para extremos */
            --iron-90: #1A1A1A;        /* quase preto, profundidade */
            --iron-80: #2E2E2E;        /* cinza muito escuro — base de algumas superfícies */
            --iron-70: #404040;        /* cinza médio-escuro, principal para textos */
            --iron-60: #5A5A5A;        /* cinza médio, bordas e linhas */
            --iron-50: #737373;        /* cinza médio-claro, elementos secundários */
            --iron-40: #8F8F8F;        /* cinza claro, elevações suaves */
            --iron-30: #ADADAD;        /*接近 branco, usado apenas para contraste extremo */
            --iron-20: #C8C8C8;
            --iron-10: #E6E6E6;

            --foreground: var(--iron-70);
            --background: var(--iron-95);      /* fundo principal: preto suave */
            --surface: var(--iron-90);          /* cartões: quase preto, levemente mais claro */
            --border-dim: var(--iron-80);       /* bordas discretas */
            --text-primary: var(--iron-30);     /* títulos e valores importantes — cinza claro */
            --text-secondary: var(--iron-50);   /* labels e metadados */
            --accent-muted: var(--iron-40);     /* toques de interação sem cor */
        }

        body {
            background: var(--background);
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, sans-serif;
            color: var(--foreground);
            font-weight: 350;
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-font-smoothing: antialiased;
        }

        /* estrutura principal — monolito cinza muito escuro */
        .shell {
            max-width: 420px;
            width: 100%;
            margin: 2rem 1.5rem;
            background: var(--surface);
            border: 1px solid var(--border-dim);
            box-shadow: 0 30px 50px -20px rgba(0, 0, 0, 0.9);
        }

        /* tipografia apenas peso, sem ícones lúdicos */
        h2, h3, .label, .value, .nav-item, .tag {
            font-weight: 340;
            letter-spacing: -0.01em;
            text-transform: uppercase;
        }

        .label-micro {
            font-size: 0.6rem;
            color: var(--text-secondary);
            letter-spacing: 0.2em;
            margin-bottom: 0.3rem;
        }

        /* --- header --- */
        .header-zone {
            padding: 2rem 1.5rem 1.2rem;
            border-bottom: 1px solid var(--border-dim);
        }

        .user-tag {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .operator {
            font-size: 0.7rem;
            color: var(--text-secondary);
            letter-spacing: 0.3em;
        }

        .status-pip {
            width: 6px;
            height: 6px;
            background: var(--iron-60);
        }

        .balance-area {
            margin: 0.5rem 0 0.2rem;
        }

        .value-main {
            font-size: 3.2rem;
            font-weight: 280;
            color: var(--text-primary);
            line-height: 1;
            font-family: 'Inter', monospace;
            letter-spacing: -0.03em;
            transition: filter 0.2s;
        }

        .value-main.blur {
            filter: blur(8px);
        }

        .action-row {
            display: flex;
            gap: 1.8rem;
            margin-top: 1.5rem;
        }

        .action-text {
            font-size: 0.6rem;
            color: var(--text-secondary);
            letter-spacing: 0.15em;
            cursor: pointer;
            border-bottom: 1px solid transparent;
            transition: 0.1s;
        }

        .action-text:hover {
            color: var(--iron-30);
            border-bottom: 1px solid var(--iron-40);
        }

        /* --- métricas gêmeas (cinza sobre preto) --- */
        .duo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1px;
            background: var(--border-dim);
            margin: 1.2rem 1.5rem;
        }

        .duo-cell {
            background: var(--surface);
            padding: 1.2rem 0.8rem;
        }

        .duo-label {
            font-size: 0.55rem;
            color: var(--text-secondary);
            letter-spacing: 0.15em;
        }

        .duo-value {
            font-size: 1.7rem;
            font-weight: 260;
            color: var(--text-primary);
            font-family: 'Inter', monospace;
        }

        .duo-value.blur {
            filter: blur(5px);
        }

        /* --- microfone silencioso (apenas texto/forma) --- */
        .comm-center {
            margin: 1rem 1.5rem 2rem 1.5rem;
            border: 1px solid var(--border-dim);
            background: var(--iron-90);
            padding: 1.8rem 1rem 1.5rem;
        }

        .comm-prompt {
            font-size: 0.55rem;
            color: var(--text-secondary);
            letter-spacing: 0.4em;
            text-align: center;
        }

        .comm-activator {
            display: flex;
            justify-content: center;
            margin: 1.5rem 0;
        }

        .cold-circle {
            width: 66px;
            height: 66px;
            border: 1px solid var(--iron-60);
            background: var(--iron-90);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: 100;
            color: var(--iron-40);
            cursor: pointer;
            transition: 0.15s;
            border-radius: 0; /* mantém angular, sem infantilidade */
        }

        .cold-circle:hover {
            background: var(--iron-80);
            color: var(--iron-20);
            border-color: var(--iron-40);
        }

        .cold-circle.active {
            background: var(--iron-70);
            border-color: var(--iron-30);
            animation: faint-pulse 1.2s infinite;
        }

        @keyframes faint-pulse {
            0% { border-color: var(--iron-60); }
            50% { border-color: var(--iron-30); }
            100% { border-color: var(--iron-60); }
        }

        .status-line {
            font-size: 0.6rem;
            color: var(--text-secondary);
            text-align: center;
            min-height: 1.2rem;
            letter-spacing: 0.1em;
        }

        .transcript-line {
            font-size: 0.7rem;
            color: var(--iron-30);
            text-align: center;
            border-top: 1px dashed var(--iron-80);
            margin-top: 1rem;
            padding-top: 0.9rem;
            min-height: 2.5rem;
            font-style: normal;
        }

        /* --- extrato — só linhas e números --- */
        .ledger-section {
            margin: 1.5rem 1.5rem 5rem 1.5rem;
            border-top: 1px solid var(--border-dim);
            padding-top: 1rem;
        }

        .ledger-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.55rem;
            color: var(--text-secondary);
            letter-spacing: 0.2em;
            margin-bottom: 0.8rem;
        }

        .row-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--iron-80);
        }

        .row-left {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .row-desc {
            font-size: 0.8rem;
            color: var(--text-primary);
            font-weight: 300;
            text-transform: none;
        }

        .row-cat {
            font-size: 0.55rem;
            color: var(--text-secondary);
        }

        .row-number {
            font-size: 0.95rem;
            color: var(--iron-30);
            font-family: 'Inter', monospace;
        }

        .row-number.income {
            color: var(--iron-20);
        }

        .row-number.expense {
            color: var(--iron-50);
        }

        .empty-ledger {
            text-align: center;
            padding: 2rem 0;
            color: var(--iron-70);
            font-size: 0.7rem;
            letter-spacing: 0.1em;
        }

        /* --- navegação inferior com cinza dominante --- */
        .bottom-bar {
            background: var(--iron-90);
            border-top: 1px solid var(--border-dim);
            display: flex;
            justify-content: space-around;
            padding: 0.8rem 1rem 1rem;
            position: sticky;
            bottom: 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.4rem;
            color: var(--text-secondary);
            font-size: 0.55rem;
            letter-spacing: 0.15em;
            cursor: default;
        }

        .nav-item.active {
            color: var(--iron-30);
        }

        .nav-dot {
            width: 2px;
            height: 2px;
            background: currentColor;
        }

        .fob {
            width: 44px;
            height: 44px;
            background: var(--iron-80);
            border: 1px solid var(--iron-60);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: var(--iron-30);
            margin-top: -20px;
            cursor: pointer;
            transition: 0.1s;
        }

        .fob:hover {
            background: var(--iron-70);
            color: var(--iron-10);
        }

        /* --- overlay de entrada --- */
        .entry-veil {
            position: fixed;
            inset: 0;
            background: var(--iron-95);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.7s ease;
        }

        .entry-dialog {
            max-width: 280px;
            background: var(--surface);
            border: 1px solid var(--border-dim);
            padding: 2rem;
            text-align: center;
        }

        .entry-title {
            font-size: 1.2rem;
            color: var(--text-primary);
            letter-spacing: 0.3em;
            font-weight: 280;
            margin-bottom: 1.8rem;
        }

        .entry-button {
            background: transparent;
            border: 1px solid var(--iron-60);
            color: var(--iron-40);
            padding: 0.8rem 2rem;
            font-size: 0.7rem;
            letter-spacing: 0.2em;
            width: 100%;
            cursor: pointer;
            transition: 0.1s;
        }

        .entry-button:hover {
            background: var(--iron-80);
            color: var(--iron-20);
        }

        /* utilitários */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- tela de entrada cinza escura -->
    <div id="overlayEntry" class="entry-veil">
        <div class="entry-dialog">
            <div class="entry-title">ÆSIR</div>
            <div style="color: var(--iron-60); font-size:0.6rem; margin:1rem 0;">interface cinza</div>
            <button class="entry-button" id="enterSystem">acessar</button>
        </div>
    </div>

    <!-- aplicação principal -->
    <div class="shell">
        <header class="header-zone">
            <div class="user-tag">
                <span class="operator">▸ operador_04</span>
                <span class="status-pip"></span>
            </div>
            <div class="balance-area">
                <div class="label-micro">saldo</div>
                <div class="value-main" id="mainBalance">R$ 0,00</div>
            </div>
            <div class="action-row">
                <span class="action-text" id="hideAction">[ ocultar ]</span>
                <span class="action-text" id="eraseAction">[ limpar ]</span>
                <span class="action-text" id="monthAction">[ dezembro ]</span>
            </div>
        </header>

        <!-- estatísticas duas cores de cinza -->
        <div class="duo-grid">
            <div class="duo-cell">
                <div class="duo-label">receita</div>
                <div class="duo-value" id="incomeDisplay">R$ 0,00</div>
            </div>
            <div class="duo-cell">
                <div class="duo-label">despesa</div>
                <div class="duo-value" id="expenseDisplay">R$ 0,00</div>
            </div>
        </div>

        <!-- comando de voz (visual extremamente contido) -->
        <div class="comm-center">
            <div class="comm-prompt">> entrada acústica <</div>
            <div class="comm-activator">
                <div class="cold-circle" id="voiceTrigger">⌥</div>
            </div>
            <div class="status-line" id="voiceStatus">standby</div>
            <div class="transcript-line" id="voiceFeedback"></div>
        </div>

        <!-- registro de movimentos -->
        <div class="ledger-section">
            <div class="ledger-header">
                <span>movimento</span>
                <span>montante</span>
            </div>
            <div id="transactionList">
                <div class="empty-ledger">— vazio —</div>
            </div>
        </div>

        <!-- barra inferior -->
        <div class="bottom-bar">
            <div class="nav-item active"><span class="nav-dot"></span>início</div>
            <div class="nav-item"><span class="nav-dot"></span>gráfico</div>
            <div class="fob" id="fabVoice">+</div>
            <div class="nav-item"><span class="nav-dot"></span>arquivo</div>
            <div class="nav-item"><span class="nav-dot"></span>sistema</div>
        </div>
    </div>

    <script>
        (function() {
            // estado — cinza, sem alegria
            let transactions = [];
            try {
                const stored = localStorage.getItem('aesir_ledger');
                if (stored) transactions = JSON.parse(stored);
            } catch (e) {}

            let hidden = false;
            let listening = false;
            let recognition = null;
            let synth = window.speechSynthesis;
            let voiceSelected = null;

            // categorias com nomes sóbrios
            const categories = {
                'alim': { name: 'alim.', keywords: ['almoço','jantar','café','restaurante','lanche','mercado','supermercado','comida'] },
                'transp': { name: 'transp', keywords: ['uber','taxi','ônibus','metrô','gasolina','combustível'] },
                'moradia': { name: 'morad', keywords: ['aluguel','condomínio','água','luz','energia','gás'] },
                'comum': { name: 'comum', keywords: ['internet','telefone','streaming'] },
                'outro': { name: 'outro', keywords: [] }
            };

            // formatação seca
            function formatBRL(val) {
                return 'R$ ' + val.toFixed(2).replace('.', ',');
            }

            function refreshUI() {
                const income = transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
                const expense = transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
                const balance = income - expense;

                document.getElementById('mainBalance').textContent = formatBRL(balance);
                document.getElementById('incomeDisplay').textContent = formatBRL(income);
                document.getElementById('expenseDisplay').textContent = formatBRL(expense);

                const mainEl = document.getElementById('mainBalance');
                const incomeEl = document.getElementById('incomeDisplay');
                const expenseEl = document.getElementById('expenseDisplay');

                if (hidden) {
                    mainEl.classList.add('blur');
                    incomeEl.classList.add('blur');
                    expenseEl.classList.add('blur');
                } else {
                    mainEl.classList.remove('blur');
                    incomeEl.classList.remove('blur');
                    expenseEl.classList.remove('blur');
                }

                // lista de transações
                const container = document.getElementById('transactionList');
                if (transactions.length === 0) {
                    container.innerHTML = '<div class="empty-ledger">— vazio —</div>';
                    return;
                }

                let html = '';
                transactions.slice(0, 10).forEach(t => {
                    let catName = 'outro';
                    for (let [key, c] of Object.entries(categories)) {
                        if (c.keywords.some(kw => t.description.toLowerCase().includes(kw))) {
                            catName = c.name;
                            break;
                        }
                    }
                    const sign = t.type === 'income' ? '' : '−';
                    html += `
                        <div class="row-item">
                            <div class="row-left">
                                <span class="row-desc">${t.description.substring(0, 20)}</span>
                                <span class="row-cat">${catName}</span>
                            </div>
                            <div class="row-number ${t.type}">${sign} ${formatBRL(t.amount)}</div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            }

            function persist() {
                localStorage.setItem('aesir_ledger', JSON.stringify(transactions));
                refreshUI();
            }

            function addTrans(type, val, desc) {
                transactions.unshift({
                    id: Date.now() + Math.random(),
                    type: type,
                    amount: val,
                    description: desc.substring(0, 24),
                    date: new Date().toLocaleDateString('pt-BR')
                });
                persist();
            }

            function clearAllTrans() {
                if (transactions.length && confirm('apagar todo o registro?')) {
                    transactions = [];
                    persist();
                    speak('registro limpo');
                }
            }

            // Voz
            function loadVoices() {
                const v = synth.getVoices();
                voiceSelected = v.find(v => v.lang.includes('pt-BR')) || v.find(v => v.lang.includes('pt')) || v[0];
            }
            loadVoices();
            if (synth.onvoiceschanged) synth.onvoiceschanged = loadVoices;

            function speak(msg) {
                if (!synth) return;
                synth.cancel();
                const u = new SpeechSynthesisUtterance(msg);
                u.lang = 'pt-BR';
                u.rate = 0.9;
                if (voiceSelected) u.voice = voiceSelected;
                synth.speak(u);
            }

            // Reconhecimento
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SR();
                recognition.lang = 'pt-BR';
                recognition.continuous = false;
                recognition.interimResults = true;

                recognition.onstart = () => {
                    listening = true;
                    document.getElementById('voiceTrigger').classList.add('active');
                    document.getElementById('voiceStatus').innerText = '> ouvindo <';
                };
                recognition.onend = () => {
                    listening = false;
                    document.getElementById('voiceTrigger').classList.remove('active');
                    document.getElementById('voiceStatus').innerText = 'standby';
                    setTimeout(() => document.getElementById('voiceFeedback').innerText = '', 1500);
                };
                recognition.onerror = () => {
                    listening = false;
                    document.getElementById('voiceTrigger').classList.remove('active');
                    document.getElementById('voiceStatus').innerText = 'falha';
                };
                recognition.onresult = (ev) => {
                    const last = ev.results[ev.results.length-1];
                    const transcript = last[0].transcript;
                    document.getElementById('voiceFeedback').innerText = '> ' + transcript + ' <';
                    if (last.isFinal) {
                        parseCommand(transcript);
                    }
                };
            }

            function parseCommand(cmd) {
                const lower = cmd.toLowerCase();
                // extrair número
                let amount = null;
                const mapa = {
                    'zero':0,'um':1,'dois':2,'três':3,'tres':3,'quatro':4,'cinco':5,'seis':6,'sete':7,'oito':8,'nove':9,
                    'dez':10,'onze':11,'doze':12,'treze':13,'quatorze':14,'quinze':15,'vinte':20,'trinta':30,
                    'quarenta':40,'cinquenta':50,'sessenta':60,'setenta':70,'oitenta':80,'noventa':90,'cem':100,
                    'cento':100,'duzentos':200,'trezentos':300
                };
                let parsed = lower;
                for (let [w, n] of Object.entries(mapa)) parsed = parsed.replace(new RegExp('\\b' + w + '\\b','g'), n);
                const nums = parsed.match(/\d+/g);
                if (nums) amount = parseInt(nums[0], 10);

                const isIncome = /recebi|ganhei|salário|entrada/i.test(lower);
                const type = isIncome ? 'income' : 'expense';

                let desc = cmd
                    .replace(/\d+\s*mil/gi, '')
                    .replace(/\d+/g, '')
                    .replace(/reais?/gi, '')
                    .replace(/r\$/gi, '')
                    .replace(/\b(gastei|paguei|comprei|recebi|ganhei|de|em|para|um|uma)\b/gi, '')
                    .trim()
                    .replace(/\s+/g, ' ');

                if (!desc || desc.length < 2) desc = type === 'income' ? 'receita' : 'despesa';

                if (amount && amount > 0) {
                    addTrans(type, amount, desc);
                    speak(`registro: ${formatBRL(amount)}`);
                    document.getElementById('voiceStatus').innerText = '✓ registrado';
                } else {
                    speak('valor não identificado');
                    document.getElementById('voiceStatus').innerText = '? não compreendido';
                }
            }

            function toggleListening() {
                if (!recognition) { speak('voz indisponível'); return; }
                if (listening) recognition.stop();
                else recognition.start();
            }

            // --- inicialização ---
            refreshUI();

            // overlay
            const veil = document.getElementById('overlayEntry');
            const enterBtn = document.getElementById('enterSystem');
            enterBtn.addEventListener('click', () => {
                veil.style.opacity = '0';
                setTimeout(() => veil.style.display = 'none', 700);
                // mensagem de boas vindas (sóbria)
                setTimeout(() => {
                    const h = new Date().getHours();
                    let greet = h < 12 ? 'bom dia' : h < 18 ? 'boa tarde' : 'boa noite';
                    let msg = `${greet}, sistema cinza.`;
                    if (transactions.length) msg += ` ${transactions.length} movimentos.`;
                    else msg += ' toque no microfone para comandar.';
                    speak(msg);
                }, 800);
            });

            // botoes
            document.getElementById('voiceTrigger').addEventListener('click', toggleListening);
            document.getElementById('fabVoice').addEventListener('click', toggleListening);
            document.getElementById('hideAction').addEventListener('click', () => {
                hidden = !hidden;
                refreshUI();
                document.getElementById('hideAction').innerText = hidden ? '[ mostrar ]' : '[ ocultar ]';
            });
            document.getElementById('eraseAction').addEventListener('click', clearAllTrans);
            document.getElementById('monthAction').addEventListener('click', () => speak('dezembro'));
        })();
    </script>
</body>
</html>
